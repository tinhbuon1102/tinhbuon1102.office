if("undefined"==typeof jQuery)throw new Error("addel requires jQuery");!function(t){"use strict";var e="addel",n=function(n,i){var s=this;this.$container=t(n),this.settings=t.extend(!0,{},t.fn[e].defaults,i),this.settings.formElements="input, select, textarea",["hide","add"].forEach(function(t){s.settings[t]=s.$container.data(e+"-"+t)||s.settings[t]}),["duration","easing"].forEach(function(t){s.settings.animation[t]=s.$container.data(e+"-animation-"+t)||s.settings.animation[t]}),this.selectors={},t.each(this.settings.classes,function(t,n){s.selectors[t]="."+n+", [data-"+e+"-"+t+"]"})};n.prototype={init:function(){this.settings.hide&&this.toggleTargetInputDisable(this.getLastTarget()).hide(),this.$container.on("click",this.selectors.add,{plugin:this},this.add).on("click",this.selectors["delete"],{plugin:this},this["delete"]).on("addel:add",this.settings.events.add).on("addel:added",this.settings.events.added).on("addel:delete",this.settings.events["delete"]).on("addel:deleted",this.settings.events.deleted)},add:function(n){var i=n.data.plugin,s=i.getLastTarget(),d=t(this).data(e+"-add")||i.settings.add;if(i.triggerAddEvent(s).isDefaultPrevented())return!1;var a=t();0===i.getVisibleTargetsCount()&&(d--,i.toggleTargetVisibility(s),a=a.add(s)),a=a.add(i.addTarget(s,d)),i.focusOnTargetInput(a),i.triggerAddedEvent(s,a)},addTarget:function(e,n){var i=t();e.finish();for(var s=0;n>s;s++){var d=e.clone();i=i.add(d),d.insertAfter(e).hide().fadeIn(this.settings.animation).find(this.settings.formElements).val(null)}return i},"delete":function(e){var n=e.data.plugin,i=t(this).closest(n.selectors.target);return n.triggerDeleteEvent(i).isDefaultPrevented()?!1:(1===n.getVisibleTargetsCount()?(n.toggleTargetVisibility(i),n.focusOnAdd()):(n.focusOnDelete(i),n.deleteTarget(i)),void n.triggerDeletedEvent(i))},deleteTarget:function(e){e.addClass("addel-deleting").fadeOut(this.settings.animation.duration,this.settings.animation.easing,function(){t(this).remove()})},toggleTargetVisibility:function(t){this.toggleTargetInputDisable(t).fadeToggle(this.settings.animation)},toggleTargetInputDisable:function(t){return t.find(this.settings.formElements).prop("disabled",function(t,e){return!e}),t},focusOnTargetInput:function(t){t.last().find(":input:enabled:visible:first").focus()},focusOnAdd:function(){this.$container.find(this.selectors.add).first().focus()},focusOnDelete:function(t){var e=t.prev(this.selectors.target).not(".addel-deleting"),n=t.next(this.selectors.target).not(".addel-deleting"),i=e.length?e:n;i.find(this.selectors["delete"]).focus()},getLastTarget:function(t){return this.$container.find(this.selectors.target).slice(-t||-1)},getVisibleTargetsCount:function(){return this.$container.find(this.selectors.target).filter(":visible").not(".addel-deleting").length},triggerAddEvent:function(e){var n=t.Event("addel:add",{target:e});return this.$container.trigger(n),n},triggerAddedEvent:function(e,n){this.$container.trigger(t.Event("addel:added",{target:e,added:n}))},triggerDeleteEvent:function(e){var n=t.Event("addel:delete",{target:e});return this.$container.trigger(n),n},triggerDeletedEvent:function(e){this.$container.trigger(t.Event("addel:deleted",{target:e}))}},t.fn[e]=function(i){return this.each(function(){t.data(this,"plugin_"+e)||t.data(this,"plugin_"+e,new n(this,i)).init()})},t.fn[e].defaults={hide:!1,add:1,classes:{target:"addel-target",add:"addel-add","delete":"addel-delete"},animation:{duration:0,easing:"swing"},events:{add:function(){},added:function(){},"delete":function(){},deleted:function(){}}}}(jQuery);